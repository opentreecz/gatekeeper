services:
  # 1. The Gatekeeper (Your Custom Session Manager)
  gatekeeper:
    build: ./gatekeeper
    env_file: ./.env
    ports:
      - "80:5000"   # Public HTTP maps to container's port 5000
      - "443:5001"  # Public HTTPS maps to container's port 5001
    networks:
      - app-net
    depends_on:
      - redis
      - my-app-1
      - my-app-2
      - my-app-3

  # 2. Redis (The State Tracker)
  redis:
    image: "redis:7-alpine"
    networks:
      - app-net

  # 3. Your Application Pool (Scale by adding more here)
  #    These must be running HTTPS on port 443 as defined in .env
  my-app-1:
    image: "nginx:latest" # <-- REPLACE with your app's image
    networks:
      - app-net
    # Your app container must be configured to serve HTTPS on port 443

  my-app-2:
    image: "nginx:latest" # <-- REPLACE with your app's image
    networks:
      - app-net

  my-app-3:
    image: "nginx:latest" # <-- REPLACE with your app's image
    networks:
      - app-net

networks:
  app-net:
    driver: bridge

