version: "3.8"

networks:
  app-net:
    driver: bridge

services:
  # 1. The Gatekeeper (Your Custom Session Manager)
  gatekeeper:
    build: ./gatekeeper
    env_file: ./.env
    ports:
      - "80:5000" # Expose gatekeeper on port 80 to the world
    networks:
      - app-net
    depends_on:
      - redis
      - my-app-1
      - my-app-2
      - my-app-3

  # 2. Redis (The State Tracker)
  redis:
    image: "redis:7-alpine"
    networks:
      - app-net

  # 3. Your Application Pool (Scale by adding more here)
  my-app-1:
    image: "nginx:latest" # <-- REPLACE with your app's image
    networks:
      - app-net
    # Your app runs on port 80 inside the container

  my-app-2:
    image: "nginx:latest" # <-- REPLACE with your app's image
    networks:
      - app-net

  my-app-3:
    image: "nginx:latest" # <-- REPLACE with your app's image
    networks:
      - app-net
